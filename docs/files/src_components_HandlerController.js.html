<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../assets/css/yui-cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon.ico">
    <script src="../assets/js/yui-source.js"></script>
	<title>platypus v2.0.0 API Documentation : src\components\HandlerController.js</title>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><a href="https://github.com/PBS-KIDS/Platypus"><img src="..\assets\platypus-title.png" title="platypus"></a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Documentation for: 2.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/platypus.AABB.html">platypus.AABB</a></li>
                                <li><a href="../classes/platypus.ActionState.html">platypus.ActionState</a></li>
                                <li><a href="../classes/platypus.AssetManager.html">platypus.AssetManager</a></li>
                                <li><a href="../classes/platypus.Async.html">platypus.Async</a></li>
                                <li><a href="../classes/platypus.CollisionData.html">platypus.CollisionData</a></li>
                                <li><a href="../classes/platypus.CollisionDataContainer.html">platypus.CollisionDataContainer</a></li>
                                <li><a href="../classes/platypus.CollisionShape.html">platypus.CollisionShape</a></li>
                                <li><a href="../classes/platypus.Component.html">platypus.Component</a></li>
                                <li><a href="../classes/platypus.components.AIChaser.html">platypus.components.AIChaser</a></li>
                                <li><a href="../classes/platypus.components.AIPacer.html">platypus.components.AIPacer</a></li>
                                <li><a href="../classes/platypus.components.AudioMusic.html">platypus.components.AudioMusic</a></li>
                                <li><a href="../classes/platypus.components.AudioSFX.html">platypus.components.AudioSFX</a></li>
                                <li><a href="../classes/platypus.components.AudioVO.html">platypus.components.AudioVO</a></li>
                                <li><a href="../classes/platypus.components.Camera.html">platypus.components.Camera</a></li>
                                <li><a href="../classes/platypus.components.CameraFollowMe.html">platypus.components.CameraFollowMe</a></li>
                                <li><a href="../classes/platypus.components.CollisionBasic.html">platypus.components.CollisionBasic</a></li>
                                <li><a href="../classes/platypus.components.CollisionFilter.html">platypus.components.CollisionFilter</a></li>
                                <li><a href="../classes/platypus.components.CollisionGroup.html">platypus.components.CollisionGroup</a></li>
                                <li><a href="../classes/platypus.components.CollisionTiles.html">platypus.components.CollisionTiles</a></li>
                                <li><a href="../classes/platypus.components.ComponentSwitcher.html">platypus.components.ComponentSwitcher</a></li>
                                <li><a href="../classes/platypus.components.Counter.html">platypus.components.Counter</a></li>
                                <li><a href="../classes/platypus.components.EntityContainer.html">platypus.components.EntityContainer</a></li>
                                <li><a href="../classes/platypus.components.EntityController.html">platypus.components.EntityController</a></li>
                                <li><a href="../classes/platypus.components.HandlerCollision.html">platypus.components.HandlerCollision</a></li>
                                <li><a href="../classes/platypus.components.HandlerController.html">platypus.components.HandlerController</a></li>
                                <li><a href="../classes/platypus.components.HandlerLogic.html">platypus.components.HandlerLogic</a></li>
                                <li><a href="../classes/platypus.components.HandlerRender.html">platypus.components.HandlerRender</a></li>
                                <li><a href="../classes/platypus.components.Interactive.html">platypus.components.Interactive</a></li>
                                <li><a href="../classes/platypus.components.LevelBuilder.html">platypus.components.LevelBuilder</a></li>
                                <li><a href="../classes/platypus.components.LogicAngularMovement.html">platypus.components.LogicAngularMovement</a></li>
                                <li><a href="../classes/platypus.components.LogicAttachment.html">platypus.components.LogicAttachment</a></li>
                                <li><a href="../classes/platypus.components.LogicButton.html">platypus.components.LogicButton</a></li>
                                <li><a href="../classes/platypus.components.LogicCarrier.html">platypus.components.LogicCarrier</a></li>
                                <li><a href="../classes/platypus.components.LogicDestroyMe.html">platypus.components.LogicDestroyMe</a></li>
                                <li><a href="../classes/platypus.components.LogicDirectionalMovement.html">platypus.components.LogicDirectionalMovement</a></li>
                                <li><a href="../classes/platypus.components.LogicDragDrop.html">platypus.components.LogicDragDrop</a></li>
                                <li><a href="../classes/platypus.components.LogicPortable.html">platypus.components.LogicPortable</a></li>
                                <li><a href="../classes/platypus.components.LogicRotationalMovement.html">platypus.components.LogicRotationalMovement</a></li>
                                <li><a href="../classes/platypus.components.LogicTimer.html">platypus.components.LogicTimer</a></li>
                                <li><a href="../classes/platypus.components.LogicWindUpRacer.html">platypus.components.LogicWindUpRacer</a></li>
                                <li><a href="../classes/platypus.components.Motion.html">platypus.components.Motion</a></li>
                                <li><a href="../classes/platypus.components.Mover.html">platypus.components.Mover</a></li>
                                <li><a href="../classes/platypus.components.NodeMap.html">platypus.components.NodeMap</a></li>
                                <li><a href="../classes/platypus.components.NodeResident.html">platypus.components.NodeResident</a></li>
                                <li><a href="../classes/platypus.components.Orientation.html">platypus.components.Orientation</a></li>
                                <li><a href="../classes/platypus.components.RandomEvents.html">platypus.components.RandomEvents</a></li>
                                <li><a href="../classes/platypus.components.RelativePosition.html">platypus.components.RelativePosition</a></li>
                                <li><a href="../classes/platypus.components.RelayFamily.html">platypus.components.RelayFamily</a></li>
                                <li><a href="../classes/platypus.components.RelayGame.html">platypus.components.RelayGame</a></li>
                                <li><a href="../classes/platypus.components.RelayLinker.html">platypus.components.RelayLinker</a></li>
                                <li><a href="../classes/platypus.components.RelayParent.html">platypus.components.RelayParent</a></li>
                                <li><a href="../classes/platypus.components.RelaySelf.html">platypus.components.RelaySelf</a></li>
                                <li><a href="../classes/platypus.components.RenderAnimator.html">platypus.components.RenderAnimator</a></li>
                                <li><a href="../classes/platypus.components.RenderContainer.html">platypus.components.RenderContainer</a></li>
                                <li><a href="../classes/platypus.components.RenderDebug.html">platypus.components.RenderDebug</a></li>
                                <li><a href="../classes/platypus.components.RenderDestroyMe.html">platypus.components.RenderDestroyMe</a></li>
                                <li><a href="../classes/platypus.components.RenderProgress.html">platypus.components.RenderProgress</a></li>
                                <li><a href="../classes/platypus.components.RenderSpine.html">platypus.components.RenderSpine</a></li>
                                <li><a href="../classes/platypus.components.RenderSprite.html">platypus.components.RenderSprite</a></li>
                                <li><a href="../classes/platypus.components.RenderText.html">platypus.components.RenderText</a></li>
                                <li><a href="../classes/platypus.components.RenderTiles.html">platypus.components.RenderTiles</a></li>
                                <li><a href="../classes/platypus.components.SceneChanger.html">platypus.components.SceneChanger</a></li>
                                <li><a href="../classes/platypus.components.TiledLoader.html">platypus.components.TiledLoader</a></li>
                                <li><a href="../classes/platypus.components.Timeline.html">platypus.components.Timeline</a></li>
                                <li><a href="../classes/platypus.components.Tutorial.html">platypus.components.Tutorial</a></li>
                                <li><a href="../classes/platypus.components.Tween.html">platypus.components.Tween</a></li>
                                <li><a href="../classes/platypus.components.VoiceOver.html">platypus.components.VoiceOver</a></li>
                                <li><a href="../classes/platypus.components.XHR.html">platypus.components.XHR</a></li>
                                <li><a href="../classes/platypus.Data.html">platypus.Data</a></li>
                                <li><a href="../classes/platypus.DataMap.html">platypus.DataMap</a></li>
                                <li><a href="../classes/platypus.Entity.html">platypus.Entity</a></li>
                                <li><a href="../classes/platypus.EntityLinker.html">platypus.EntityLinker</a></li>
                                <li><a href="../classes/platypus.Game.html">platypus.Game</a></li>
                                <li><a href="../classes/platypus.Gamepad.html">platypus.Gamepad</a></li>
                                <li><a href="../classes/platypus.Messenger.html">platypus.Messenger</a></li>
                                <li><a href="../classes/platypus.PIXIAnimation.html">platypus.PIXIAnimation</a></li>
                                <li><a href="../classes/platypus.SFXPlayer.html">platypus.SFXPlayer</a></li>
                                <li><a href="../classes/platypus.StateMap.html">platypus.StateMap</a></li>
                                <li><a href="../classes/platypus.Storage.html">platypus.Storage</a></li>
                                <li><a href="../classes/platypus.Vector.html">platypus.Vector</a></li>
                                <li><a href="../classes/platypus.VOPlayer.html">platypus.VOPlayer</a></li>
                                <li><a href="../classes/window.Map.html">window.Map</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/platypus.html">platypus</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
            <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <script>
                        	var name = src\components\HandlerController.js      
                        </script>
                        <h1 class="file-heading">File:src\components\HandlerController.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        /**
                         * This component handles capturing and relaying input information to the entities that care about it. It takes mouse, keyboard, and custom input messages. State messages are sent immediately to the entities when they are received, the &#x27;HandlerController&#x27; message is sent to demarcate ticks.
                         *
                         * @namespace platypus.components
                         * @class HandlerController
                         * @uses platypus.Component
                         */
                        /* global platypus, window */
                        import {arrayCache, greenSplice} from &#x27;../utils/array.js&#x27;;
                        import Gamepad from &#x27;../Gamepad.js&#x27;;
                        import createComponentClass from &#x27;../factory.js&#x27;;
                        
                        const
                            /**
                             * Sends a &#x27;handle-controller&#x27; message to all the entities the component is handling. If an entity does not handle the message, it&#x27;s removed it from the entity list.
                             *
                             * @method &#x27;broadcastHandleController&#x27;
                             * @param tick {Object} An object containing tick data.
                             */
                            broadcastHandleController = function (tick) {
                                if (hasGamepads) {
                                    const
                                        gamepads = [...window.navigator.getGamepads()],
                                        standards = this.gamepads;
                        
                                    for (let i = 0; i &lt; gamepads.length; i++) {
                                        const gamepad = gamepads[i];
                        
                                        if (gamepad) {
                                            const standard = standards[gamepad.index];
                        
                                            if (!standard) { // set up initial values so events can be triggered later
                                                standards[gamepad.index] = Gamepad.setUp(gamepad, onDown.bind(this, &#x27;gamepad&#x27;), onUp.bind(this, &#x27;gamepad&#x27;), onChange.bind(this, &#x27;gamepad&#x27;));
                                            } else {
                                                standard.update(gamepad);
                                            }
                                        }
                                    }
                                }
                        
                                /**
                                 * Triggered on owner and child entities on each tick to handle whatever they need to regarding controls.
                                 *
                                 * @event &#x27;handle-controller&#x27;
                                 * @param tick {Object} An object containing tick data.
                                 */
                                this.triggerOnAll(&#x27;handle-controller&#x27;, tick);
                            },
                            onDown = function (type, event) {
                                /**
                                 *  Triggered on owner and child entities when a key goes from up to down.
                                 *
                                 * @event &#x27;[event.code]:down&#x27;
                                 * @param event {DOMEvent} The DOM event that triggered the keydown event.
                                 */
                                this.triggerControlAction(event.code, &#x27;down&#x27;, event);
                        
                                updatePrecedence(type);
                            },
                            onUp = function (type, event) {
                                /**
                                 * Triggered on owner and child entities when a key goes from down to up.
                                 *
                                 * @event &#x27;[event.code]:up&#x27;
                                 * @param event {DOMEvent} The DOM event that triggered the keyup event.
                                 */
                                this.triggerControlAction(event.code, &#x27;up&#x27;, event);
                        
                                updatePrecedence(type);
                            },
                            onChange = function (type, event) {
                                /**
                                 * Triggered on owner and child entities when an axis changes.
                                 *
                                 * @event &#x27;[event.code]:change&#x27;
                                 * @param event {DOMEvent} The event that triggered the change event.
                                 */
                                this.triggerControlAction(event.code, &#x27;change&#x27;, event);
                        
                                updatePrecedence(type);
                            },
                            updatePrecedence = (type) =&gt; {
                                if (type !== inputs[0]) {
                                    const was = inputs.indexOf(type);
                        
                                    if (was &gt; 0) {
                                        greenSplice(inputs, was);
                                    }
                        
                                    inputs.unshift(type);
                        
                                    for (let i = 0; i &lt; notifies.length; i++) {
                                        notifies[i](inputs);
                                    }
                                }
                            },
                            inputs = [],
                            notifies = [],
                            detectInvalids = {},
                            detectProcessing = {};
                        let hasGamepads = false,
                            gameWideReady = false;
                        
                        window.addEventListener(&quot;gamepadconnected&quot;, () =&gt; {
                            hasGamepads = true;
                            updatePrecedence(&#x27;gamepad&#x27;);
                        });
                        
                        window.addEventListener(&#x27;touchstart&#x27;, () =&gt; {
                            updatePrecedence(&#x27;touch&#x27;);
                        });
                        
                        window.addEventListener(&#x27;mousedown&#x27;, () =&gt; {
                            updatePrecedence(&#x27;mouse&#x27;);
                        });
                        
                          
                        //window.addEventListener(&quot;gamepaddisconnected&quot;, (event) =&gt; {});
                        
                        export default createComponentClass({
                            
                            id: &#x27;HandlerController&#x27;,
                            properties: {
                                /**
                                 * Whether &#x27;handle-controller&#x27; event should fire based on the &#x27;handle-logic&#x27; event instead of the &#x27;tick&#x27; event.
                                 *
                                 * @property useHandleLogic
                                 * @type Boolean
                                 * @default false
                                 */
                                useHandleLogic: false
                            },
                        
                            publicProperties: {
                                inputPrecedence: inputs
                            },
                            
                            initialize: function () {
                                if (platypus.game.settings.debug) { // If this is a test build, leave in the browser key combinations so debug tools can be opened as expected.
                                    this.callbackKeyDown = onDown.bind(this, &#x27;keyboard&#x27;);
                                    this.callbackKeyUp = onUp.bind(this, &#x27;keyboard&#x27;);
                                } else { // Otherwise remove default browser behavior for key inputs so that they do not interfere with game-play.
                                    this.callbackKeyDown = (event) =&gt; {
                                        onDown.call(this, &#x27;keyboard&#x27;, event);
                                        event.preventDefault(); // this may be too aggressive - if problems arise, we may need to limit this to certain key combos that get in the way of game-play. Example: (event.metaKey &amp;&amp; event.keyCode == 37) causes an accidental cmd key press to send the browser back a page while playing and hitting the left arrow button.
                                    };
                                    this.callbackKeyUp = (event) =&gt; {
                                        onUp.call(this, &#x27;keyboard&#x27;, event);
                                        event.preventDefault(); // this may be too aggressive - if problems arise, we may need to limit this to certain key combos that get in the way of game-play. Example: (event.metaKey &amp;&amp; event.keyCode == 37) causes an accidental cmd key press to send the browser back a page while playing and hitting the left arrow button.
                                    };
                                }
                                
                                window.addEventListener(&#x27;keydown&#x27;, this.callbackKeyDown, true);
                                window.addEventListener(&#x27;keyup&#x27;,   this.callbackKeyUp,   true);
                        
                                if (this.useHandleLogic) {
                                    this.addEventListener(&#x27;handle-logic&#x27;, broadcastHandleController);
                                } else {
                                    this.addEventListener(&#x27;tick&#x27;, broadcastHandleController);
                                }
                        
                                this.gamepads = arrayCache.setUp();
                        
                                this.notifier = (inputs) =&gt; {
                                    /**
                                     * Triggered on owner and child entities when player uses a new imput method. (For example, going from mouse to keyboard or keyboard to gamepad.)
                                     *
                                     * @event &#x27;input-precedence-updated&#x27;
                                     * @param inputs {Array} A list of input methods, ordered by precedence with index 0 being the most recent input method.
                                     */
                                    this.triggerOnAll(&#x27;input-precedence-updated&#x27;, inputs);
                                };
                                notifies.push(this.notifier);
                        
                                if (!gameWideReady) { // Need info at the game level to handle missed control input across layers
                                    gameWideReady = true;
                                    platypus.game.on(&#x27;tick&#x27;, function () {
                                        for (const key in detectInvalids) {
                                            if (detectInvalids.hasOwnProperty(key)) {
                                                if (detectInvalids[key] === 0) {
                                                    this.triggerOnChildren(&#x27;invalid-input&#x27;, key);
                                                } else {
                                                    this.triggerOnChildren(&#x27;valid-input&#x27;, key);
                                                }
                                                delete detectInvalids[key];
                                            }
                                        }
                                    }.bind(platypus.game));
                                }
                            },
                            events: {
                                &#x27;invalid-input&#x27;: function (input) {
                                    this.owner.triggerEventOnChildren(&#x27;invalid-input&#x27;, input);
                                },
                                &#x27;valid-input&#x27;: function (input) {
                                    this.owner.triggerEventOnChildren(&#x27;valid-input&#x27;, input);
                                }
                            },
                            methods: {
                                destroy: function () {
                                    window.removeEventListener(&#x27;keydown&#x27;, this.callbackKeyDown);
                                    window.removeEventListener(&#x27;keyup&#x27;,   this.callbackKeyUp);
                                    for (let i = 0; i &lt; this.gamepads.length; i++) {
                                        if (this.gamepads[i]) {
                                            this.gamepads[i].recycle();
                                        }
                                    }
                                    arrayCache.recycle(this.gamepads);
                                    greenSplice(notifies, notifies.indexOf(this.notifier));
                                },
                                triggerControlAction: function (control, action, ...args) {
                                    const
                                        event = &#x60;${control}:${action}&#x60;;
                        
                                    detectProcessing[control] = (detectProcessing[control] || 0) + this.triggerOnAll(event, ...args);
                                    if (action === &#x27;up&#x27;) {
                                        detectInvalids[control] = (detectInvalids[control] || 0) + detectProcessing[control];
                                        detectProcessing[control] = 0;
                                    }
                                },
                                triggerOnAll: function (event, ...args) {
                                    const
                                        owner = this.owner;
                                    let count = owner.triggerEvent(event, ...args);
                        
                                    if (owner.triggerEventOnChildren) {
                                        count += owner.triggerEventOnChildren(event, ...args);
                                    }
                                    
                                    return count;
                                }
                            }
                        });
                        
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
