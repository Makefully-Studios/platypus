<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../assets/css/yui-cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/x-icon" href="../assets/favicon.ico">
    <script src="../assets/js/yui-source.js"></script>
	<title>platypus v2.0.0 API Documentation : src\PIXIAnimation.js</title>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><a href="https://github.com/PBS-KIDS/Platypus"><img src="..\assets\platypus-title.png" title="platypus"></a></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Documentation for: 2.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/platypus.AABB.html">platypus.AABB</a></li>
                                <li><a href="../classes/platypus.ActionState.html">platypus.ActionState</a></li>
                                <li><a href="../classes/platypus.AssetManager.html">platypus.AssetManager</a></li>
                                <li><a href="../classes/platypus.Async.html">platypus.Async</a></li>
                                <li><a href="../classes/platypus.CollisionData.html">platypus.CollisionData</a></li>
                                <li><a href="../classes/platypus.CollisionDataContainer.html">platypus.CollisionDataContainer</a></li>
                                <li><a href="../classes/platypus.CollisionShape.html">platypus.CollisionShape</a></li>
                                <li><a href="../classes/platypus.Component.html">platypus.Component</a></li>
                                <li><a href="../classes/platypus.components.AIChaser.html">platypus.components.AIChaser</a></li>
                                <li><a href="../classes/platypus.components.AIPacer.html">platypus.components.AIPacer</a></li>
                                <li><a href="../classes/platypus.components.AudioMusic.html">platypus.components.AudioMusic</a></li>
                                <li><a href="../classes/platypus.components.AudioSFX.html">platypus.components.AudioSFX</a></li>
                                <li><a href="../classes/platypus.components.AudioVO.html">platypus.components.AudioVO</a></li>
                                <li><a href="../classes/platypus.components.Camera.html">platypus.components.Camera</a></li>
                                <li><a href="../classes/platypus.components.CameraFollowMe.html">platypus.components.CameraFollowMe</a></li>
                                <li><a href="../classes/platypus.components.CollisionBasic.html">platypus.components.CollisionBasic</a></li>
                                <li><a href="../classes/platypus.components.CollisionFilter.html">platypus.components.CollisionFilter</a></li>
                                <li><a href="../classes/platypus.components.CollisionGroup.html">platypus.components.CollisionGroup</a></li>
                                <li><a href="../classes/platypus.components.CollisionTiles.html">platypus.components.CollisionTiles</a></li>
                                <li><a href="../classes/platypus.components.ComponentSwitcher.html">platypus.components.ComponentSwitcher</a></li>
                                <li><a href="../classes/platypus.components.Counter.html">platypus.components.Counter</a></li>
                                <li><a href="../classes/platypus.components.EntityContainer.html">platypus.components.EntityContainer</a></li>
                                <li><a href="../classes/platypus.components.EntityController.html">platypus.components.EntityController</a></li>
                                <li><a href="../classes/platypus.components.HandlerCollision.html">platypus.components.HandlerCollision</a></li>
                                <li><a href="../classes/platypus.components.HandlerController.html">platypus.components.HandlerController</a></li>
                                <li><a href="../classes/platypus.components.HandlerLogic.html">platypus.components.HandlerLogic</a></li>
                                <li><a href="../classes/platypus.components.HandlerRender.html">platypus.components.HandlerRender</a></li>
                                <li><a href="../classes/platypus.components.Interactive.html">platypus.components.Interactive</a></li>
                                <li><a href="../classes/platypus.components.LevelBuilder.html">platypus.components.LevelBuilder</a></li>
                                <li><a href="../classes/platypus.components.LogicAngularMovement.html">platypus.components.LogicAngularMovement</a></li>
                                <li><a href="../classes/platypus.components.LogicAttachment.html">platypus.components.LogicAttachment</a></li>
                                <li><a href="../classes/platypus.components.LogicButton.html">platypus.components.LogicButton</a></li>
                                <li><a href="../classes/platypus.components.LogicCarrier.html">platypus.components.LogicCarrier</a></li>
                                <li><a href="../classes/platypus.components.LogicDestroyMe.html">platypus.components.LogicDestroyMe</a></li>
                                <li><a href="../classes/platypus.components.LogicDirectionalMovement.html">platypus.components.LogicDirectionalMovement</a></li>
                                <li><a href="../classes/platypus.components.LogicDragDrop.html">platypus.components.LogicDragDrop</a></li>
                                <li><a href="../classes/platypus.components.LogicPortable.html">platypus.components.LogicPortable</a></li>
                                <li><a href="../classes/platypus.components.LogicRotationalMovement.html">platypus.components.LogicRotationalMovement</a></li>
                                <li><a href="../classes/platypus.components.LogicTimer.html">platypus.components.LogicTimer</a></li>
                                <li><a href="../classes/platypus.components.LogicWindUpRacer.html">platypus.components.LogicWindUpRacer</a></li>
                                <li><a href="../classes/platypus.components.Motion.html">platypus.components.Motion</a></li>
                                <li><a href="../classes/platypus.components.Mover.html">platypus.components.Mover</a></li>
                                <li><a href="../classes/platypus.components.NodeMap.html">platypus.components.NodeMap</a></li>
                                <li><a href="../classes/platypus.components.NodeResident.html">platypus.components.NodeResident</a></li>
                                <li><a href="../classes/platypus.components.Orientation.html">platypus.components.Orientation</a></li>
                                <li><a href="../classes/platypus.components.RandomEvents.html">platypus.components.RandomEvents</a></li>
                                <li><a href="../classes/platypus.components.RelativePosition.html">platypus.components.RelativePosition</a></li>
                                <li><a href="../classes/platypus.components.RelayFamily.html">platypus.components.RelayFamily</a></li>
                                <li><a href="../classes/platypus.components.RelayGame.html">platypus.components.RelayGame</a></li>
                                <li><a href="../classes/platypus.components.RelayLinker.html">platypus.components.RelayLinker</a></li>
                                <li><a href="../classes/platypus.components.RelayParent.html">platypus.components.RelayParent</a></li>
                                <li><a href="../classes/platypus.components.RelaySelf.html">platypus.components.RelaySelf</a></li>
                                <li><a href="../classes/platypus.components.RenderAnimator.html">platypus.components.RenderAnimator</a></li>
                                <li><a href="../classes/platypus.components.RenderContainer.html">platypus.components.RenderContainer</a></li>
                                <li><a href="../classes/platypus.components.RenderDebug.html">platypus.components.RenderDebug</a></li>
                                <li><a href="../classes/platypus.components.RenderDestroyMe.html">platypus.components.RenderDestroyMe</a></li>
                                <li><a href="../classes/platypus.components.RenderProgress.html">platypus.components.RenderProgress</a></li>
                                <li><a href="../classes/platypus.components.RenderSpine.html">platypus.components.RenderSpine</a></li>
                                <li><a href="../classes/platypus.components.RenderSprite.html">platypus.components.RenderSprite</a></li>
                                <li><a href="../classes/platypus.components.RenderText.html">platypus.components.RenderText</a></li>
                                <li><a href="../classes/platypus.components.RenderTiles.html">platypus.components.RenderTiles</a></li>
                                <li><a href="../classes/platypus.components.SceneChanger.html">platypus.components.SceneChanger</a></li>
                                <li><a href="../classes/platypus.components.TiledLoader.html">platypus.components.TiledLoader</a></li>
                                <li><a href="../classes/platypus.components.Timeline.html">platypus.components.Timeline</a></li>
                                <li><a href="../classes/platypus.components.Tutorial.html">platypus.components.Tutorial</a></li>
                                <li><a href="../classes/platypus.components.Tween.html">platypus.components.Tween</a></li>
                                <li><a href="../classes/platypus.components.VoiceOver.html">platypus.components.VoiceOver</a></li>
                                <li><a href="../classes/platypus.components.XHR.html">platypus.components.XHR</a></li>
                                <li><a href="../classes/platypus.Data.html">platypus.Data</a></li>
                                <li><a href="../classes/platypus.DataMap.html">platypus.DataMap</a></li>
                                <li><a href="../classes/platypus.Entity.html">platypus.Entity</a></li>
                                <li><a href="../classes/platypus.EntityLinker.html">platypus.EntityLinker</a></li>
                                <li><a href="../classes/platypus.Game.html">platypus.Game</a></li>
                                <li><a href="../classes/platypus.Gamepad.html">platypus.Gamepad</a></li>
                                <li><a href="../classes/platypus.Messenger.html">platypus.Messenger</a></li>
                                <li><a href="../classes/platypus.PIXIAnimation.html">platypus.PIXIAnimation</a></li>
                                <li><a href="../classes/platypus.SFXPlayer.html">platypus.SFXPlayer</a></li>
                                <li><a href="../classes/platypus.StateMap.html">platypus.StateMap</a></li>
                                <li><a href="../classes/platypus.Storage.html">platypus.Storage</a></li>
                                <li><a href="../classes/platypus.Vector.html">platypus.Vector</a></li>
                                <li><a href="../classes/platypus.VOPlayer.html">platypus.VOPlayer</a></li>
                                <li><a href="../classes/window.Map.html">window.Map</a></li>
                            </ul>
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/platypus.html">platypus</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
            <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <script>
                        	var name = src\PIXIAnimation.js      
                        </script>
                        <h1 class="file-heading">File:src\PIXIAnimation.js</h1>
                        
                        <div class="file">
                            <pre class="code prettyprint linenums">
                        /**
                         * This class plays animation sequences of frames and mimics the syntax required for creating CreateJS Sprites, allowing CreateJS Sprite Sheet definitions to be used with PixiJS.
                         *
                         * @class PIXIAnimation
                         */
                        /*global platypus */
                        import {AnimatedSprite, BaseTexture, Container, Point, Rectangle, Sprite, Texture} from &#x27;pixi.js&#x27;;
                        import {arrayCache, greenSlice} from &#x27;./utils/array.js&#x27;;
                        import Data from &#x27;./Data.js&#x27;;
                        
                        export default (function () {
                            var MAX_KEY_LENGTH_PER_IMAGE = 128,
                                animationCache = {},
                                baseTextureCache = {},
                                doNothing = function () {},
                                emptyFrame = Texture.EMPTY,
                                regex = /[\[\]{},-]/g,
                                getBaseTextures = function (images) {
                                    var i = 0,
                                        bts = arrayCache.setUp(),
                                        asset = null,
                                        assetCache = platypus.assetCache,
                                        btCache = baseTextureCache,
                                        path = null;
                                    
                                    for (i = 0; i &lt; images.length; i++) {
                                        path = images[i];
                                        if (typeof path === &#x27;string&#x27;) {
                                            if (!btCache[path]) {
                                                asset = assetCache.get(path);
                                                if (!asset) {
                                                    platypus.debug.warn(&#x27;&quot;&#x27; + path + &#x27;&quot; is not a loaded asset.&#x27;);
                                                    break;
                                                }
                                                btCache[path] = new BaseTexture(asset);
                                            }
                                            bts.push(btCache[path]);
                                        } else {
                                            bts.push(new BaseTexture(path));
                                        }
                                    }
                                    
                                    return bts;
                                },
                                getTexturesCacheId = function (spriteSheet) {
                                    var i = 0;
                                    
                                    if (spriteSheet.id) {
                                        return spriteSheet.id;
                                    }
                                    
                                    for (i = 0; i &lt; spriteSheet.images.length; i++) {
                                        if (typeof spriteSheet.images[i] !== &#x27;string&#x27;) {
                                            return &#x27;&#x27;;
                                        }
                                    }
                                    
                                    spriteSheet.id = JSON.stringify(spriteSheet).replace(regex, &#x27;&#x27;);
                        
                                    return spriteSheet.id;
                                },
                                getDefaultAnimation = function (length, textures) {
                                    var frames = arrayCache.setUp(),
                                        i = 0;
                                    
                                    for (i = 0; i &lt; length; i++) {
                                        frames.push(textures[i] || emptyFrame);
                                    }
                                    return Data.setUp(
                                        &quot;id&quot;, &quot;default&quot;,
                                        &quot;frames&quot;, frames,
                                        &quot;next&quot;, &quot;default&quot;,
                                        &quot;speed&quot;, 1
                                    );
                                },
                                standardizeAnimations = function (def, textures) {
                                    var animation = &#x27;&#x27;,
                                        anims = Data.setUp(),
                                        i = 0,
                                        frames = null,
                                        key = &#x27;&#x27;;
                                    
                                    for (key in def) {
                                        if (def.hasOwnProperty(key)) {
                                            animation = def[key];
                                            frames = greenSlice(animation.frames);
                                            i = frames.length;
                                            while (i--) {
                                                frames[i] = textures[frames[i]] || emptyFrame;
                                            }
                                            anims[key] = Data.setUp(
                                                &quot;id&quot;, key,
                                                &quot;frames&quot;, frames,
                                                &quot;next&quot;, animation.next,
                                                &quot;speed&quot;, animation.speed
                                            );
                                        }
                                    }
                        
                                    if (!anims.default) {
                                        // Set up a default animation that plays through all frames
                                        anims.default = getDefaultAnimation(textures.length, textures);
                                    }
                                    
                                    return anims;
                                },
                                getAnimations = function (spriteSheet) {
                                    var i = 0,
                                        anims    = null,
                                        frame    = null,
                                        frames   = spriteSheet.frames,
                                        images   = spriteSheet.images,
                                        textures = arrayCache.setUp(),
                                        bases    = getBaseTextures(images);
                        
                                    // Set up texture for each frame
                                    for (i = 0; i &lt; frames.length; i++) {
                                        frame = frames[i];
                                        textures.push(new Texture(bases[frame[4]], new Rectangle(frame[0], frame[1], frame[2], frame[3]), null, null, 0, new Point((frame[5] || 0) / frame[2], (frame[6] || 0) / frame[3])));
                                    }
                        
                                    // Set up animations
                                    anims = standardizeAnimations(spriteSheet.animations, textures);
                        
                                    // Set up a default animation that plays through all frames
                                    if (!anims.default) {
                                        anims.default = getDefaultAnimation(textures.length, textures);
                                    }
                                    
                                    arrayCache.recycle(bases);
                                    
                                    return Data.setUp(
                                        &quot;textures&quot;, textures,
                                        &quot;animations&quot;, anims
                                    );
                                },
                                cacheAnimations = function (spriteSheet, cacheId) {
                                    var i = 0,
                                        anims    = null,
                                        frame    = null,
                                        frames   = spriteSheet.frames,
                                        images   = spriteSheet.images,
                                        textures = arrayCache.setUp(),
                                        bases    = getBaseTextures(images);
                        
                                    // Set up texture for each frame
                                    for (i = 0; i &lt; frames.length; i++) {
                                        frame = frames[i];
                                        textures.push(new Texture(bases[frame[4]], new Rectangle(frame[0], frame[1], frame[2], frame[3]), null, null, 0, new Point((frame[5] || 0) / frame[2], (frame[6] || 0) / frame[3])));
                                    }
                        
                                    // Set up animations
                                    anims = standardizeAnimations(spriteSheet.animations, textures);
                        
                                    arrayCache.recycle(bases);
                                    
                                    return Data.setUp(
                                        &quot;textures&quot;, textures,
                                        &quot;animations&quot;, anims,
                                        &quot;viable&quot;, 1,
                                        &quot;cacheId&quot;, cacheId
                                    );
                                },
                                PIXIAnimation = function (spriteSheet, animation) {
                                    var FR = 60,
                                        cacheId = getTexturesCacheId(spriteSheet),
                                        cache = (cacheId ? animationCache[cacheId] : null),
                                        speed = (spriteSheet.framerate || FR) / FR;
                        
                                    if (!cacheId) {
                                        cache = getAnimations(spriteSheet);
                                    } else if (!cache) {
                                        cache = animationCache[cacheId] = cacheAnimations(spriteSheet, cacheId);
                                        this.cacheId = cacheId;
                                    } else {
                                        cache.viable += 1;
                                        this.cacheId = cacheId;
                                    }
                        
                                    Container.call(this); //, cache.textures[0].texture
                                
                                    /**
                                    * @private
                                    */
                                    this._animations = {};
                                    for (const key in cache.animations) {
                                        if (cache.animations[key].frames.length === 1) {
                                            this._animations[key] = new Sprite(cache.animations[key].frames[0]);
                                        } else {
                                            const anim = this._animations[key] = new AnimatedSprite(cache.animations[key].frames);
                        
                                            anim.animationSpeed = speed * cache.animations[key].speed;
                                            anim.onComplete = anim.onLoop = function (animation, properties) {
                                                if (this.onComplete) {
                                                    this.onComplete(animation);
                                                }
                                                if (properties.next) {
                                                    this.gotoAndPlay(properties.next);
                                                }
                                            }.bind(this, key, cache.animations[key]);
                                            anim.updateAnchor = true;
                                        }
                                    }
                                    
                                    this._animation = null;
                                
                                    /**
                                    * The speed that the PIXIAnimation will play at. Higher is faster, lower is slower
                                    *
                                    * @member {number}
                                    * @default 1
                                    */
                                    this.animationSpeed = speed;
                        
                                    /**
                                     * The currently playing animation name.
                                     *
                                     * @property currentAnimation
                                     * @default &quot;&quot;
                                     * @type String
                                     */
                                    this.currentAnimation = null;
                                
                                    /**
                                    * Indicates if the PIXIAnimation is currently playing
                                    *
                                    * @member {boolean}
                                    * @readonly
                                    */
                                    this.playing = false;
                                    
                                    this._visible = true;
                                    
                                    this._updating = false;
                        
                                    /*
                                    * Updates the object transform for rendering
                                    * @private
                                    */
                                    this.update = doNothing;
                        
                                    // Set up initial playthrough.
                                    this.gotoAndPlay(animation);
                                },
                                prototype = PIXIAnimation.prototype = Object.create(Container.prototype);
                            
                            PIXIAnimation.prototype.constructor = PIXIAnimation;
                            
                            Object.defineProperties(prototype, {
                                /**
                                * The visibility of the sprite.
                                *
                                * @property visible
                                * @memberof PIXI.DisplayObject#
                                */
                                visible: {
                                    get: function () {
                                        return this._visible;
                                    },
                                    set: function (value) {
                                        this._visible = value;
                                    }
                                },
                                
                                /**
                                * The PIXIAnimations paused state. If paused, the animation doesn&#x27;t update.
                                *
                                * @property paused
                                */
                                paused: {
                                    get: function () {
                                        return !this.playing;
                                    },
                                    set: function (value) {
                                        if ((value &amp;&amp; this.playing) || (!value &amp;&amp; !this.playing)) {
                                            this.playing = !value;
                                        }
                                    }
                                }
                            
                            });
                            
                            /**
                            * Stops the PIXIAnimation
                            *
                            * @method stop
                            */
                            prototype.stop = function () {
                                this.paused = true;
                            };
                            
                            /**
                            * Plays the PIXIAnimation
                            *
                            * @method play
                            */
                            prototype.play = function () {
                                this.paused = false;
                            };
                            
                            /**
                            * Stops the PIXIAnimation and goes to a specific frame
                            *
                            * @method gotoAndStop
                            * @param animation {number} frame index to stop at
                            */
                            prototype.gotoAndStop = function (animation) {
                                this.stop();
                                if (this._animation &amp;&amp; this._animation.stop) {
                                    this._animation.stop();
                                }
                            
                                this._animation = this._animations[animation];
                                if (!this._animation) {
                                    this._animation = this._animations.default;
                                }
                                this.removeChildren();
                                this.addChild(this._animation);
                            };
                            
                            /**
                            * Goes to a specific frame and begins playing the PIXIAnimation
                            *
                            * @method gotoAndPlay
                            * @param animation {string} The animation to begin playing.
                            * @param [loop = true] {Boolean} Whether this animation should loop.
                            * @param [restart = true] {Boolean} Whether to restart the animation if it&#x27;s currently playing.
                            */
                            prototype.gotoAndPlay = function (animation, loop = true, restart = true) {
                                if ((this.currentAnimation !== animation) || restart) {
                                    if (this._animation &amp;&amp; this._animation.stop) {
                                        this._animation.stop();
                                    }
                                    this._animation = this._animations[animation];
                                    this.currentAnimation = animation;
                                    if (!this._animation) {
                                        this._animation = this._animations.default;
                                        this.currentAnimation = &#x27;default&#x27;;
                                    }
                                    this.removeChildren();
                                    this.addChild(this._animation);
                                }
                        
                                this._animation.loop = loop;
                                
                                if (this._animation.play) {
                                    this._animation.play();
                                }
                                this.play();
                            };
                            
                            /**
                            * Returns whether a particular animation is available.
                            *
                            * @method has
                            * @param animation {string} The animation to check.
                            */
                            prototype.has = function (animation) {
                                return !!this._animations[animation];
                            };
                            
                            /**
                             * Stops the PIXIAnimation and destroys it
                             *
                             * @method destroy
                             */
                            prototype.destroy = function () {
                                var key = &#x27;&#x27;;
                                
                                this.stop();
                                if (this._animation &amp;&amp; this._animation.stop) {
                                    this._animation.stop();
                                }
                                Container.prototype.destroy.call(this);
                                if (this.cacheId) {
                                    animationCache[this.cacheId].viable -= 1;
                                    if (animationCache[this.cacheId].viable &lt;= 0) {
                                        arrayCache.recycle(animationCache[this.cacheId].textures);
                                        for (key in animationCache[this.cacheId].animations) {
                                            if (animationCache[this.cacheId].animations.hasOwnProperty(key)) {
                                                arrayCache.recycle(animationCache[this.cacheId].animations[key].frames);
                                            }
                                        }
                                        delete animationCache[this.cacheId];
                                    }
                                }
                            };
                            
                            PIXIAnimation.EmptySpriteSheet = {
                                framerate: 60,
                                frames: [],
                                images: [],
                                animations: {},
                                recycleSpriteSheet: function () {
                                    // We don&#x27;t recycle this sprite sheet.
                                }
                            };
                            
                            /**
                             * This method formats a provided value into a valid PIXIAnimation Sprite Sheet. This includes accepting the EaselJS spec, strings mapping to Platypus sprite sheets, or arrays of either.
                             *
                             * @method PIXIAnimation.formatSpriteSheet
                             * @param spriteSheet {String|Array|Object} The value to cast to a valid Sprite Sheet.
                             * @return {Object}
                             */
                            PIXIAnimation.formatSpriteSheet = (function () {
                                var imageParts = /([\w-]+)\.(\w+)$/,
                                    addAnimations = function (source, destination, speedRatio, firstFrameIndex, id) {
                                        var key = &#x27;&#x27;;
                                        
                                        for (key in source) {
                                            if (source.hasOwnProperty(key)) {
                                                if (destination[key]) {
                                                    arrayCache.recycle(destination[key].frames);
                                                    destination[key].recycle();
                                                    platypus.debug.olive(&#x27;PIXIAnimation &quot;&#x27; + id + &#x27;&quot;: Overwriting duplicate animation for &quot;&#x27; + key + &#x27;&quot;.&#x27;);
                                                }
                                                destination[key] = formatAnimation(key, source[key], speedRatio, firstFrameIndex);
                                            }
                                        }
                                    },
                                    addFrameObject = function (source, destination, firstImageIndex, bases) {
                                        var i = 0,
                                            fw = source.width,
                                            fh = source.height,
                                            rx = source.regX || 0,
                                            ry = source.regY || 0,
                                            w = 0,
                                            h = 0,
                                            x = 0,
                                            y = 0;
                                        
                                        for (i = 0; i &lt; bases.length; i++) {
                                            
                                            // Subtract the size of a frame so that margin slivers aren&#x27;t returned as frames.
                                            w = bases[i].realWidth - fw;
                                            h = bases[i].realHeight - fh;
                                            
                                            for (y = 0; y &lt;= h; y += fh) {
                                                for (x = 0; x &lt;= w; x += fw) {
                                                    destination.push([x, y, fw, fh, i + firstImageIndex, rx, ry]);
                                                }
                                            }
                                        }
                                    },
                                    addFrameArray = function (source, destination, firstImageIndex) {
                                        var frame = null,
                                            i = 0;
                                        
                                        for (i = 0; i &lt; source.length; i++) {
                                            frame = source[i];
                                            destination.push(arrayCache.setUp(
                                                frame[0],
                                                frame[1],
                                                frame[2],
                                                frame[3],
                                                frame[4] + firstImageIndex,
                                                frame[5],
                                                frame[6]
                                            ));
                                        }
                                    },
                                    createId = function (images) {
                                        var i = images.length,
                                            id = &#x27;&#x27;,
                                            segment = &#x27;&#x27;,
                                            separator = &#x27;&#x27;;
                        
                                        while (i--) {
                                            segment = images[i].src || images[i];
                                            id += separator + segment.substring(0, MAX_KEY_LENGTH_PER_IMAGE);
                                            separator = &#x27;,&#x27;;
                                        }
                        
                                        return id;
                                    },
                                    format = function (source, destination) {
                                        var bases = null,
                                            dAnims = destination.animations,
                                            dImages = destination.images,
                                            dFR = destination.framerate || 60,
                                            dFrames = destination.frames,
                                            i = 0,
                                            images = arrayCache.setUp(),
                                            firstImageIndex = dImages.length,
                                            firstFrameIndex = dFrames.length,
                                            sAnims = source.animations,
                                            sImages = source.images,
                                            sFR = source.framerate || 60,
                                            sFrames = source.frames;
                                        
                                        // Set up id
                                        if (destination.id) {
                                            destination.id += &#x27;;&#x27; + (source.id || createId(source.images));
                                        } else {
                                            destination.id = source.id || createId(source.images);
                                        }
                                        
                                        // Set up images array
                                        for (i = 0; i &lt; sImages.length; i++) {
                                            images.push(formatImages(sImages[i]));
                                            dImages.push(images[i]);
                                        }
                        
                                        // Set up frames array
                                        if (Array.isArray(sFrames)) {
                                            addFrameArray(sFrames, dFrames, firstImageIndex);
                                        } else {
                                            bases = getBaseTextures(images);
                                            addFrameObject(sFrames, dFrames, firstImageIndex, bases);
                                            arrayCache.recycle(bases);
                                        }
                                        
                                        // Set up animations object
                                        addAnimations(sAnims, dAnims, sFR / dFR, firstFrameIndex, destination.id);
                                        
                                        arrayCache.recycle(images);
                                        
                                        return destination;
                                    },
                                    formatAnimation = function (key, animation, speedRatio, firstFrameIndex) {
                                        var i = 0,
                                            first = 0,
                                            frames = arrayCache.setUp(),
                                            last = 0;
                                        
                                        if (typeof animation === &#x27;number&#x27;) {
                                            frames.push(animation + firstFrameIndex);
                                            return Data.setUp(
                                                &quot;frames&quot;, frames,
                                                &quot;next&quot;, key,
                                                &quot;speed&quot;, speedRatio
                                            );
                                        } else if (Array.isArray(animation)) {
                                            first = animation[0] || 0;
                                            last = (animation[1] || first) + 1 + firstFrameIndex;
                                            first += firstFrameIndex;
                                            for (i = first; i &lt; last; i++) {
                                                frames.push(i);
                                            }
                                            return Data.setUp(
                                                &quot;frames&quot;, frames,
                                                &quot;next&quot;, animation[2] || key,
                                                &quot;speed&quot;, (animation[3] || 1) * speedRatio
                                            );
                                        } else {
                                            for (i = 0; i &lt; animation.frames.length; i++) {
                                                frames.push(animation.frames[i] + firstFrameIndex);
                                            }
                                            return Data.setUp(
                                                &quot;frames&quot;, frames,
                                                &quot;next&quot;, animation.next || key,
                                                &quot;speed&quot;, (animation.speed || 1) * speedRatio
                                            );
                                        }
                                    },
                                    formatImages = function (name) {
                                        var match = false;
                                        
                                        if (typeof name === &#x27;string&#x27;) {
                                            match = name.match(imageParts);
                        
                                            if (match) {
                                                return match[1];
                                            }
                                        }
                        
                                        return name;
                                    },
                                    recycle = function () {
                                        var animations = this.animations,
                                            key = &#x27;&#x27;;
                                        
                                        for (key in animations) {
                                            if (animations.hasOwnProperty(key)) {
                                                arrayCache.recycle(animations[key].frames);
                                            }
                                            animations[key].recycle();
                                        }
                                        
                                        arrayCache.recycle(this.frames, 2);
                                        this.frames = null;
                                        arrayCache.recycle(this.images);
                                        this.images = null;
                                        this.recycle();
                                    },
                                    merge = function (spriteSheets, destination) {
                                        var i = spriteSheets.length,
                                            ss = null;
                                        
                                        while (i--) {
                                            ss = spriteSheets[i];
                                            if (typeof ss === &#x27;string&#x27;) {
                                                ss = platypus.game.settings.spriteSheets[ss];
                                            }
                                            if (ss) {
                                                format(ss, destination);
                                            }
                                        }
                                        
                                        return destination;
                                    };
                                
                                return function (spriteSheet) {
                                    var response = PIXIAnimation.EmptySpriteSheet,
                                        ss = spriteSheet;
                                    
                                    if (typeof ss === &#x27;string&#x27;) {
                                        ss = platypus.game.settings.spriteSheets[spriteSheet];
                                    }
                                    
                                    if (ss) {
                                        response = Data.setUp(
                                            &quot;animations&quot;, Data.setUp(),
                                            &quot;framerate&quot;, 60,
                                            &quot;frames&quot;, arrayCache.setUp(),
                                            &quot;id&quot;, &#x27;&#x27;,
                                            &quot;images&quot;, arrayCache.setUp(),
                                            &quot;recycleSpriteSheet&quot;, recycle
                                        );
                                            
                                        if (Array.isArray(ss)) {
                                            return merge(ss, response);
                                        } else if (ss) {
                                            return format(ss, response);
                                        }
                                    }
                        
                                    return response;
                                };
                            }());
                        
                            return PIXIAnimation;
                        }());
                        
                            </pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
